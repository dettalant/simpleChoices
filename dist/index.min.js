/*!
 *   simpleChoices.js
 *
 * @author dettalant
 * @version v0.1.0
 * @license MIT License
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const createDiv=e=>{const t=document.createElement("div");return e&&(t.className=e),t},createSpan=e=>{const t=document.createElement("span");return e&&(t.className=e),t},createButton=e=>{const t=document.createElement("button");return e&&(t.className=e),t.type="button",t},setAriaSelected=(e,t)=>e.setAttribute("aria-selected",t.toString()),setAriaExpanded=(e,t)=>e.setAttribute("aria-expanded",t.toString());class SimpleSelectBuilder{constructor(e={}){this.classNames=Object.assign(this.defaultSelectClassNames,e)}get defaultSelectClassNames(){return{container:"simpleSelect_container",label:"simpleSelect_label",wrapper:"simpleSelect_wrapper",itemWrapper:"simpleSelect_itemWrapper",item:"simpleSelect_item",current:"simpleSelect_currentItem"}}create(e,t,r){const i=this.genSelectElements(e,t,r),s=new SimpleSelect(i,t),n=t.findIndex(e=>e.selected);return n>0&&s.updateCurrentItem(n,!1),s}genSelectElements(e,t,r=""){const i=this.classNames,s=createButton(i.container+" "+r),n=createSpan(i.label);n.textContent=e;const a=createDiv(i.wrapper),c=createDiv(i.current);c.textContent=t[0].label;const l=createDiv(i.itemWrapper);[s,l].forEach(e=>setAriaExpanded(e,!1));const d=t.map((e,t)=>{const r=i.item+" "+i.item+t,s=createDiv(r);return s.textContent=e.label,s.dataset.itemIdx=t.toString(),setAriaSelected(s,0===t),l.appendChild(s),s});return[c,l].forEach(e=>a.appendChild(e)),[n,a].forEach(e=>s.appendChild(e)),{container:s,label:n,current:c,wrapper:a,itemWrapper:l,items:d}}}class SimpleSelect{constructor(e,t){this._currentIdx=0,this._isActive=!1,this.el=e,this.items=t,this.applyEventListeners()}get isActive(){return this._isActive}get currentIdx(){return this._currentIdx}set currentIdx(e){this._currentIdx=e,this.updateCurrentItem(e)}get currentItem(){return this.items[this._currentIdx]}updateCurrentItem(e,t=!0){this.updateCurrentItemLabel(e),this.updateHighlightItem(e),t&&this.dispatchSelectItemEvent()}updateHighlightItem(e){if(e>=this.el.items.length)return;this.el.items.forEach(e=>{setAriaSelected(e,!1)});const t=this.el.items[e];setAriaSelected(t,!0),this._currentIdx=e}updateCurrentItemLabel(e){const t=this.items[e];t&&(this.el.current.textContent=t.label)}showDropdown(){const{container:e,itemWrapper:t}=this.el;[e,t].forEach(e=>setAriaExpanded(e,!0)),this._isActive=!0}hideDropdown(){return new Promise(e=>requestAnimationFrame(()=>{const{container:t,itemWrapper:r}=this.el;[t,r].forEach(e=>setAriaExpanded(e,!1)),this._isActive=!1,e()}))}dispatchSelectItemEvent(){const e=new CustomEvent("SimpleSelectItemEvent",{detail:this.items[this._currentIdx]});this.el.container.dispatchEvent(e)}onKeyDownHandler(e){if(e.stopPropagation(),!this.isActive)return void this.showDropdown();const t="ArrowDown"===e.key||40===e.keyCode,r="ArrowUp"===e.key||38===e.keyCode,i="Enter"===e.key||13===e.keyCode;if(r){const e=this._currentIdx>0?--this._currentIdx:0;this.updateHighlightItem(e)}else if(t){const e=this._currentIdx<this.items.length-1?++this._currentIdx:this._currentIdx;this.updateHighlightItem(e)}else if(i){const e=this._currentIdx;this.updateCurrentItem(e),this.hideDropdown()}}applyEventListeners(){const{container:e,items:t}=this.el;e.addEventListener("blur",()=>{this.hideDropdown()}),e.addEventListener("click",()=>{this.isActive?this.hideDropdown():this.showDropdown()}),e.addEventListener("keydown",e=>this.onKeyDownHandler(e)),t.forEach(e=>{e.addEventListener("mouseenter",()=>{const t=parseInt(e.dataset.itemIdx||"",10);this.updateHighlightItem(t)}),e.addEventListener("click",()=>{const t=parseInt(e.dataset.itemIdx||"",10);this.updateCurrentItem(t)})})}}exports.SimpleSelectBuilder=SimpleSelectBuilder;
